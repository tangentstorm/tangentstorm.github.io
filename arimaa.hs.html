<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>An Arimaa Library for Haskell.</title>
<!-- 2013-06-12 Wed 03:01 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="generator" content="Org-mode"/>
<meta name="author" content="michal"/>
<link rel="stylesheet" type="text/css" href="/etc/style.css">
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012  Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">An Arimaa Library for Haskell.</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. MODULE Arimaa</a></li>
<li><a href="#sec-2">2. The Pieces</a></li>
<li><a href="#sec-3">3. The Board</a>
<ul>
<li><a href="#sec-3-1">3.1. squares</a></li>
<li><a href="#sec-3-2">3.2. empty board</a></li>
<li><a href="#sec-3-3">3.3. the Board type</a></li>
<li><a href="#sec-3-4">3.4. traps</a></li>
</ul>
</li>
<li><a href="#sec-4">4. navigating the board</a></li>
<li><a href="#sec-5">5. Step and step parser:</a></li>
<li><a href="#sec-6">6. setting up pieces</a></li>
<li><a href="#sec-7">7. board queries</a></li>
<li><a href="#sec-8">8. Movement rules.</a>
<ul>
<li><a href="#sec-8-1">8.1. summary</a></li>
<li><a href="#sec-8-2">8.2. 1. Pieces move in cardinal directions, except that rabbits cannot move backward.</a>
<ul>
<li><a href="#sec-8-2-1">8.2.1. forward and backward:</a></li>
<li><a href="#sec-8-2-2">8.2.2. valid empty squares</a></li>
<li><a href="#sec-8-2-3">8.2.3. valid single-step moves:</a></li>
</ul>
</li>
<li><a href="#sec-8-3">8.3. 2. Pieces can push or pull weaker enemy pieces provided there are &gt;= 2 steps left.</a></li>
<li><a href="#sec-8-4">8.4. 3. A piece is frozen when adjacent to a stronger enemy, unless it is also adjacent to another friendly piece.</a></li>
<li><a href="#sec-8-5">8.5. 4. A piece is killed when placed on a trap, unless it is also adjacent to a friendly piece.</a></li>
</ul>
</li>
<li><a href="#sec-9">9. the Play State Monad</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> MODULE Arimaa</h2>
<div class="outline-text-2" id="text-1">
<p>
Arimaa is an abstract strategy game for two players.
</p>

<p>
See <a href="http://arimaa.com/arimaa/">http://arimaa.com/arimaa/</a>
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #66f;">{-</span><span style="color: #66f;"># LANGUAGE TypeSynonymInstances, OverlappingInstances #-}</span>

<span style="color: #00ffff;">import</span> <span style="color: #ff00ff;">Data.Array</span>
<span style="color: #00ffff;">import</span> <span style="color: #ff00ff;">Data.Char</span>
<span style="color: #00ffff;">import</span> <span style="color: #00ffff;">qualified</span> <span style="color: #ff00ff;">Data.Map</span> <span style="color: #00ffff;">as</span> <span style="color: #ff00ff;">Map</span>
<span style="color: #00ffff;">import</span> <span style="color: #00ffff;">qualified</span> <span style="color: #ff00ff;">Data.String.Utils</span> <span style="color: #00ffff;">as</span> <span style="color: #ff00ff;">DSU</span>
<span style="color: #00ffff;">import</span> <span style="color: #ff00ff;">Control.Monad.State</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> The Pieces</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #00ffff;">data</span> <span style="color: #ff00ff;">Animal</span> <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">R</span> <span style="color: #eedd82;">|</span> <span style="color: #ff00ff;">C</span> <span style="color: #eedd82;">|</span> <span style="color: #ff00ff;">D</span> <span style="color: #eedd82;">|</span> <span style="color: #ff00ff;">H</span> <span style="color: #eedd82;">|</span> <span style="color: #ff00ff;">M</span> <span style="color: #eedd82;">|</span> <span style="color: #ff00ff;">E</span> 
     <span style="color: #00ffff;">deriving</span> (<span style="color: #ff00ff;">Ord</span>, <span style="color: #ff00ff;">Eq</span>, <span style="color: #ff00ff;">Show</span>)
<span style="color: #00ffff;">data</span> <span style="color: #ff00ff;">Color</span> <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Gold</span> <span style="color: #eedd82;">|</span> <span style="color: #ff00ff;">Silver</span> <span style="color: #00ffff;">deriving</span> (<span style="color: #ff00ff;">Show</span>, <span style="color: #ff00ff;">Eq</span>)
<span style="color: #00ffff;">type</span> <span style="color: #ff00ff;">Colored</span> a <span style="color: #eedd82;">=</span> (<span style="color: #ff00ff;">Color</span>, a)
<span style="color: #00ffff;">type</span> <span style="color: #ff00ff;">Piece</span> <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Colored</span> <span style="color: #ff00ff;">Animal</span>

<span style="color: #ffffff; font-weight: bold;">showPiece</span> (<span style="color: #ff00ff;">Gold</span>, a)   <span style="color: #eedd82;">=</span> show a
<span style="color: #ffffff; font-weight: bold;">showPiece</span> (<span style="color: #ff00ff;">Silver</span>, a) <span style="color: #eedd82;">=</span> map toLower <span style="color: #eedd82;">$</span> show a


<span style="color: #ffffff; font-weight: bold;">gold</span>   a <span style="color: #eedd82;">=</span> (<span style="color: #ff00ff;">Gold</span>, a)
<span style="color: #ffffff; font-weight: bold;">silver</span> a <span style="color: #eedd82;">=</span> (<span style="color: #ff00ff;">Silver</span>, a)

<span style="color: #ffffff; font-weight: bold;">g</span> <span style="color: #eedd82;">=</span> gold
<span style="color: #ffffff; font-weight: bold;">s</span> <span style="color: #eedd82;">=</span> silver
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> The Board</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> squares</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">files</span> <span style="color: #eedd82;">=</span> [<span style="color: #00ff00;">'a'</span><span style="color: #eedd82;">..</span><span style="color: #00ff00;">'h'</span>]
<span style="color: #ffffff; font-weight: bold;">ranks</span> <span style="color: #eedd82;">=</span> [1<span style="color: #eedd82;">..</span>8]
<span style="color: #00ffff;">type</span> <span style="color: #ff00ff;">Square</span> <span style="color: #eedd82;">=</span> (<span style="color: #ff00ff;">Char</span>, <span style="color: #ff00ff;">Int</span>)

<span style="color: #ffffff; font-weight: bold;">showSquare</span> (x, y) <span style="color: #eedd82;">=</span> x <span style="color: #ff00ff;">:</span> show y
</pre>
</div>


<p>
To avoid bounds-checking when we look at neighboring pieces, we can surround the board with a one-cell-thick border. Thus any square next to a piece on the board will either be empty, contain a wall, or contain a piece.
</p>

<p>
As a special case, I'm putting "trap" in here, even though it evaluates to the same thing as Empty.
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #00ffff;">data</span> <span style="color: #ff00ff;">Content</span> <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Empty</span> <span style="color: #eedd82;">|</span> <span style="color: #ff00ff;">Wall</span> <span style="color: #eedd82;">|</span> <span style="color: #ff00ff;">Trap</span> <span style="color: #eedd82;">|</span> <span style="color: #ff00ff;">A</span> <span style="color: #ff00ff;">Piece</span>
<span style="color: #00ffff;">instance</span> <span style="color: #ff00ff;">Show</span> <span style="color: #ff00ff;">Content</span> <span style="color: #00ffff;">where</span>
    show c <span style="color: #eedd82;">=</span> <span style="color: #00ffff;">case</span> c <span style="color: #00ffff;">of</span>
               <span style="color: #ff00ff;">Empty</span>     <span style="color: #eedd82;">-&gt;</span> <span style="color: #00ff00;">" "</span>
               <span style="color: #ff00ff;">Trap</span>      <span style="color: #eedd82;">-&gt;</span> <span style="color: #00ff00;">"x"</span>
               <span style="color: #ff00ff;">Wall</span>      <span style="color: #eedd82;">-&gt;</span> <span style="color: #00ff00;">"#"</span>
               <span style="color: #ff00ff;">A</span> (<span style="color: #ff00ff;">Gold</span>, piece)   <span style="color: #eedd82;">-&gt;</span> show piece
               <span style="color: #ff00ff;">A</span> (<span style="color: #ff00ff;">Silver</span>, piece) <span style="color: #eedd82;">-&gt;</span> map toLower <span style="color: #eedd82;">$</span> show piece
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> empty board</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Here we build an empty board, with a border around the edge.
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #00ffff;">type</span> <span style="color: #ff00ff;">BoardShape</span> <span style="color: #eedd82;">=</span>  <span style="color: #ff00ff;">Array</span> <span style="color: #ff00ff;">Square</span> <span style="color: #ff00ff;">Content</span>
<span style="color: #00ffff;">data</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Board</span> <span style="color: #ff00ff;">BoardShape</span>
<span style="color: #ffffff; font-weight: bold;">emptyBoard</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Board</span>
<span style="color: #ffffff; font-weight: bold;">emptyBoard</span> <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">$</span> array fullBounds
           <span style="color: #eedd82;">$</span> [ (sq, initSquare sq) <span style="color: #eedd82;">|</span> sq <span style="color: #eedd82;">&lt;-</span> range fullBounds ]

<span style="color: #ffffff; font-weight: bold;">fullBounds</span> <span style="color: #eedd82;">=</span> ((westOf <span style="color: #00ff00;">'a'</span>, 0), (eastOf <span style="color: #00ff00;">'h'</span>, 9))
<span style="color: #ffffff; font-weight: bold;">coreBounds</span> <span style="color: #eedd82;">=</span> ((<span style="color: #00ff00;">'a'</span>, 1), (<span style="color: #00ff00;">'h'</span>,8))
</pre>
</div>

<p>
This may come in handy for traps later on:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">initSquare</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Square</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Content</span>
<span style="color: #ffffff; font-weight: bold;">initSquare</span> sq<span style="color: #eedd82;">@</span>(x, y)
  <span style="color: #eedd82;">|</span> (x <span style="color: #eedd82;">&lt;</span> <span style="color: #00ff00;">'a'</span>) <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Wall</span>
  <span style="color: #eedd82;">|</span> (x <span style="color: #eedd82;">&gt;</span> <span style="color: #00ff00;">'h'</span>) <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Wall</span>
  <span style="color: #eedd82;">|</span> (y <span style="color: #eedd82;">&lt;</span> 1)   <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Wall</span>
  <span style="color: #eedd82;">|</span> (y <span style="color: #eedd82;">&gt;</span> 8)   <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Wall</span>
  <span style="color: #eedd82;">|</span> isTrap sq <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Trap</span>
  <span style="color: #eedd82;">|</span> otherwise <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Empty</span>

<span style="color: #ffffff; font-weight: bold;">eastOf</span> file <span style="color: #eedd82;">=</span> chr <span style="color: #eedd82;">$</span> (ord file) <span style="color: #eedd82;">+</span> 1
<span style="color: #ffffff; font-weight: bold;">westOf</span> file <span style="color: #eedd82;">=</span> chr <span style="color: #eedd82;">$</span> (ord file) <span style="color: #eedd82;">-</span> 1
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> the Board type</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Here's a handy function to show the board, as per the standard ASCII notation
defined at <a href="http://arimaa.com/arimaa/learn/notation.html">http://arimaa.com/arimaa/learn/notation.html</a>
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">render</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">String</span>
<span style="color: #ffffff; font-weight: bold;">render</span> (<span style="color: #ff00ff;">Board</span> br) <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">DSU</span><span style="color: #eedd82;">.</span>join <span style="color: #00ff00;">"\n"</span> <span style="color: #eedd82;">$</span> map row [9,8<span style="color: #eedd82;">..</span> <span style="color: #eedd82;">-</span>1]
    <span style="color: #00ffff;">where</span> row y <span style="color: #eedd82;">|</span> y <span style="color: #eedd82;">==</span> 9 <span style="color: #eedd82;">||</span> y<span style="color: #eedd82;">==</span> 0  <span style="color: #eedd82;">=</span> <span style="color: #00ff00;">" +-----------------+"</span>
                <span style="color: #eedd82;">|</span> y <span style="color: #eedd82;">==</span> <span style="color: #eedd82;">-</span>1          <span style="color: #eedd82;">=</span> <span style="color: #00ff00;">"   a b c d e f g h  \n"</span>
                <span style="color: #eedd82;">|</span> otherwise        <span style="color: #eedd82;">=</span> show y <span style="color: #eedd82;">++</span> <span style="color: #00ff00;">"| "</span> <span style="color: #eedd82;">++</span> cells y <span style="color: #eedd82;">++</span> <span style="color: #00ff00;">" |"</span>
          cells y <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">DSU</span><span style="color: #eedd82;">.</span>join <span style="color: #00ff00;">" "</span> <span style="color: #eedd82;">$</span> map (<span style="color: #eedd82;">\</span>x <span style="color: #eedd82;">-&gt;</span> show <span style="color: #eedd82;">$</span> br <span style="color: #eedd82;">!</span> (x, y)) files

<span style="color: #00ffff;">instance</span> <span style="color: #ff00ff;">Show</span> (<span style="color: #ff00ff;">Board</span>) <span style="color: #00ffff;">where</span> 
   show <span style="color: #eedd82;">=</span> render
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> traps</h3>
<div class="outline-text-3" id="text-3-4">
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">traps</span> <span style="color: #eedd82;">::</span> [<span style="color: #ff00ff;">Square</span>]
<span style="color: #ffffff; font-weight: bold;">traps</span> <span style="color: #eedd82;">=</span> [(<span style="color: #00ff00;">'c'</span>,3), (<span style="color: #00ff00;">'c'</span>,6), (<span style="color: #00ff00;">'f'</span>,3), (<span style="color: #00ff00;">'f'</span>,6)]

<span style="color: #ffffff; font-weight: bold;">isTrap</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Square</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Bool</span>
<span style="color: #ffffff; font-weight: bold;">isTrap</span> (<span style="color: #00ff00;">'c'</span>, 3) <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">True</span>
<span style="color: #ffffff; font-weight: bold;">isTrap</span> (<span style="color: #00ff00;">'c'</span>, 6) <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">True</span>
<span style="color: #ffffff; font-weight: bold;">isTrap</span> (<span style="color: #00ff00;">'f'</span>, 3) <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">True</span>
<span style="color: #ffffff; font-weight: bold;">isTrap</span> (<span style="color: #00ff00;">'f'</span>, 6) <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">True</span>
<span style="color: #ffffff; font-weight: bold;">isTrap</span> others <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">False</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> navigating the board</h2>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #00ffff;">data</span> <span style="color: #ff00ff;">Direction</span> <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">North</span> <span style="color: #eedd82;">|</span> <span style="color: #ff00ff;">South</span> <span style="color: #eedd82;">|</span> <span style="color: #ff00ff;">East</span> <span style="color: #eedd82;">|</span> <span style="color: #ff00ff;">West</span>
  <span style="color: #00ffff;">deriving</span> (<span style="color: #ff00ff;">Eq</span>)
<span style="color: #ff00ff;">North</span> <span style="color: #ffffff; font-weight: bold;">@:</span> (x, y) <span style="color: #eedd82;">=</span> (x, y <span style="color: #eedd82;">+</span> 1)
<span style="color: #ff00ff;">South</span> <span style="color: #ffffff; font-weight: bold;">@:</span> (x, y) <span style="color: #eedd82;">=</span> (x, y <span style="color: #eedd82;">-</span> 1)
<span style="color: #ff00ff;">East</span>  <span style="color: #ffffff; font-weight: bold;">@:</span> (x, y) <span style="color: #eedd82;">=</span> (eastOf x, y)
<span style="color: #ff00ff;">West</span>  <span style="color: #ffffff; font-weight: bold;">@:</span> (x, y) <span style="color: #eedd82;">=</span> (westOf x, y)
</pre>
</div>

<p>
test: East @ ('d',3) == ('e', 3)
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #00ffff;">instance</span> (<span style="color: #ff00ff;">Show</span>) <span style="color: #ff00ff;">Direction</span> <span style="color: #00ffff;">where</span>
    show <span style="color: #ff00ff;">North</span> <span style="color: #eedd82;">=</span> <span style="color: #00ff00;">"n"</span>
    show <span style="color: #ff00ff;">South</span> <span style="color: #eedd82;">=</span> <span style="color: #00ff00;">"s"</span>
    show <span style="color: #ff00ff;">East</span>  <span style="color: #eedd82;">=</span> <span style="color: #00ff00;">"e"</span>
    show <span style="color: #ff00ff;">West</span>  <span style="color: #eedd82;">=</span> <span style="color: #00ff00;">"w"</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-haskell">(<span style="color: #ffffff; font-weight: bold;">&gt;&gt;:</span>) <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Square</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Square</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Direction</span>
(x1, y1) <span style="color: #eedd82;">&gt;&gt;:</span> (x2, y2) <span style="color: #eedd82;">=</span> diff (ord x1 <span style="color: #eedd82;">-</span> ord x2, y1<span style="color: #eedd82;">-</span>y2)
   <span style="color: #00ffff;">where</span> diff ( 1,  0) <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">West</span>
         diff (<span style="color: #eedd82;">-</span>1,  0) <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">East</span>
         diff ( 0,  1) <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">North</span>
         diff ( 0, <span style="color: #eedd82;">-</span>1) <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">South</span>
         diff <span style="color: #00ffff;">_</span>        <span style="color: #eedd82;">=</span> error <span style="color: #00ff00;">"&gt;&gt;: only works for 2 numbers"</span> 

<span style="color: #ffffff; font-weight: bold;">cardinals</span> <span style="color: #eedd82;">::</span> [<span style="color: #ff00ff;">Direction</span>]
<span style="color: #ffffff; font-weight: bold;">cardinals</span> <span style="color: #eedd82;">=</span> [<span style="color: #ff00ff;">North</span>, <span style="color: #ff00ff;">East</span>, <span style="color: #ff00ff;">South</span>, <span style="color: #ff00ff;">West</span>]

<span style="color: #ffffff; font-weight: bold;">neighborSquares</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Square</span> <span style="color: #eedd82;">-&gt;</span> [(<span style="color: #ff00ff;">Direction</span>, <span style="color: #ff00ff;">Square</span>)]
<span style="color: #ffffff; font-weight: bold;">neighborSquares</span> sq <span style="color: #eedd82;">=</span> [(dir, dir <span style="color: #eedd82;">@:</span> sq) <span style="color: #eedd82;">|</span> dir <span style="color: #eedd82;">&lt;-</span> cardinals ]

<span style="color: #ffffff; font-weight: bold;">rev</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Direction</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Direction</span>
<span style="color: #ffffff; font-weight: bold;">rev</span> <span style="color: #ff00ff;">North</span> <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">South</span>
<span style="color: #ffffff; font-weight: bold;">rev</span> <span style="color: #ff00ff;">East</span>  <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">West</span>
<span style="color: #ffffff; font-weight: bold;">rev</span> <span style="color: #ff00ff;">South</span> <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">North</span>
<span style="color: #ffffff; font-weight: bold;">rev</span> <span style="color: #ff00ff;">West</span>  <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">East</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Step and step parser:</h2>
<div class="outline-text-2" id="text-5">
<p>
Again, from the standard notation:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #00ffff;">data</span> <span style="color: #ff00ff;">Step</span>
   <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Put</span> <span style="color: #ff00ff;">Piece</span> <span style="color: #ff00ff;">Square</span>
   <span style="color: #eedd82;">|</span> <span style="color: #ff00ff;">Kill</span> <span style="color: #ff00ff;">Piece</span> <span style="color: #ff00ff;">Square</span>
   <span style="color: #eedd82;">|</span> <span style="color: #ff00ff;">Move</span> <span style="color: #ff00ff;">Piece</span> <span style="color: #ff00ff;">Square</span> <span style="color: #ff00ff;">Direction</span>
   <span style="color: #eedd82;">|</span> <span style="color: #ff00ff;">Resign</span>
   <span style="color: #eedd82;">|</span> <span style="color: #ff00ff;">Takeback</span>
   <span style="color: #00ffff;">deriving</span> (<span style="color: #ff00ff;">Eq</span>)

<span style="color: #00ffff;">instance</span> (<span style="color: #ff00ff;">Show</span>) <span style="color: #ff00ff;">Step</span> <span style="color: #00ffff;">where</span>
    show step <span style="color: #eedd82;">=</span> <span style="color: #00ffff;">case</span> step <span style="color: #00ffff;">of</span>
        <span style="color: #ff00ff;">Put</span>  p s   <span style="color: #eedd82;">-&gt;</span> sh p s
        <span style="color: #ff00ff;">Kill</span> p s   <span style="color: #eedd82;">-&gt;</span> sh p s <span style="color: #eedd82;">++</span> <span style="color: #00ff00;">"x"</span>
        <span style="color: #ff00ff;">Move</span> p s d <span style="color: #eedd82;">-&gt;</span> sh p s <span style="color: #eedd82;">++</span> show d
        <span style="color: #ff00ff;">Resign</span>     <span style="color: #eedd82;">-&gt;</span> <span style="color: #00ff00;">"resign"</span>
        <span style="color: #ff00ff;">Takeback</span>   <span style="color: #eedd82;">-&gt;</span> <span style="color: #00ff00;">"takeback"</span>
        <span style="color: #00ffff;">where</span> sh p s <span style="color: #eedd82;">=</span> showPiece p <span style="color: #eedd82;">++</span> showSquare s
</pre>
</div>


<p>
Parser is pretty simple:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">parseStep</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">String</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Step</span>
<span style="color: #ffffff; font-weight: bold;">parseStep</span> s<span style="color: #eedd82;">@</span>(p<span style="color: #ff00ff;">:</span>x<span style="color: #ff00ff;">:</span>y<span style="color: #ff00ff;">:</span>end)
  <span style="color: #eedd82;">|</span> s <span style="color: #eedd82;">==</span> <span style="color: #00ff00;">"takeback"</span> <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Takeback</span>
  <span style="color: #eedd82;">|</span> s <span style="color: #eedd82;">==</span> <span style="color: #00ff00;">"resign"</span>   <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Resign</span> 
  <span style="color: #eedd82;">|</span> end <span style="color: #eedd82;">==</span> <span style="color: #00ff00;">""</span>       <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Put</span>  pp (x, py)
  <span style="color: #eedd82;">|</span> end <span style="color: #eedd82;">==</span> <span style="color: #00ff00;">"x"</span>      <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Kill</span> pp (x, py)
  <span style="color: #eedd82;">|</span> otherwise       <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Move</span> pp (x, py) pd
  <span style="color: #00ffff;">where</span> pp <span style="color: #eedd82;">=</span> parsePiece p
        py <span style="color: #eedd82;">=</span> parseRank y
        pd <span style="color: #eedd82;">=</span> parseDirection <span style="color: #eedd82;">$</span> head end


<span style="color: #ffffff; font-weight: bold;">parsePiece</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Char</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Piece</span>
<span style="color: #ffffff; font-weight: bold;">parsePiece</span> ch <span style="color: #eedd82;">=</span> <span style="color: #00ffff;">case</span> ch <span style="color: #00ffff;">of</span> 
  <span style="color: #66f;">-- </span><span style="color: #66f;">gold pieces --</span>
  <span style="color: #00ff00;">'E'</span> <span style="color: #eedd82;">-&gt;</span> g <span style="color: #ff00ff;">E</span>
  <span style="color: #00ff00;">'M'</span> <span style="color: #eedd82;">-&gt;</span> g <span style="color: #ff00ff;">M</span>
  <span style="color: #00ff00;">'H'</span> <span style="color: #eedd82;">-&gt;</span> g <span style="color: #ff00ff;">H</span>
  <span style="color: #00ff00;">'D'</span> <span style="color: #eedd82;">-&gt;</span> g <span style="color: #ff00ff;">D</span>
  <span style="color: #00ff00;">'C'</span> <span style="color: #eedd82;">-&gt;</span> g <span style="color: #ff00ff;">C</span>
  <span style="color: #00ff00;">'R'</span> <span style="color: #eedd82;">-&gt;</span> g <span style="color: #ff00ff;">R</span>
  <span style="color: #66f;">-- </span><span style="color: #66f;">silver pieces --</span>
  <span style="color: #00ff00;">'e'</span> <span style="color: #eedd82;">-&gt;</span> s <span style="color: #ff00ff;">E</span>
  <span style="color: #00ff00;">'m'</span> <span style="color: #eedd82;">-&gt;</span> s <span style="color: #ff00ff;">M</span>
  <span style="color: #00ff00;">'h'</span> <span style="color: #eedd82;">-&gt;</span> s <span style="color: #ff00ff;">H</span>
  <span style="color: #00ff00;">'d'</span> <span style="color: #eedd82;">-&gt;</span> s <span style="color: #ff00ff;">D</span>
  <span style="color: #00ff00;">'c'</span> <span style="color: #eedd82;">-&gt;</span> s <span style="color: #ff00ff;">C</span>
  <span style="color: #00ff00;">'r'</span> <span style="color: #eedd82;">-&gt;</span> s <span style="color: #ff00ff;">R</span>

<span style="color: #ffffff; font-weight: bold;">parseRank</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Char</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Int</span>
<span style="color: #ffffff; font-weight: bold;">parseRank</span> ch <span style="color: #eedd82;">=</span> <span style="color: #00ffff;">case</span> ch <span style="color: #00ffff;">of</span>
  <span style="color: #00ff00;">'1'</span> <span style="color: #eedd82;">-&gt;</span> 1
  <span style="color: #00ff00;">'2'</span> <span style="color: #eedd82;">-&gt;</span> 2
  <span style="color: #00ff00;">'3'</span> <span style="color: #eedd82;">-&gt;</span> 3
  <span style="color: #00ff00;">'4'</span> <span style="color: #eedd82;">-&gt;</span> 4
  <span style="color: #00ff00;">'5'</span> <span style="color: #eedd82;">-&gt;</span> 5
  <span style="color: #00ff00;">'6'</span> <span style="color: #eedd82;">-&gt;</span> 6
  <span style="color: #00ff00;">'7'</span> <span style="color: #eedd82;">-&gt;</span> 7
  <span style="color: #00ff00;">'8'</span> <span style="color: #eedd82;">-&gt;</span> 8

<span style="color: #ffffff; font-weight: bold;">parseDirection</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Char</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Direction</span>
<span style="color: #ffffff; font-weight: bold;">parseDirection</span> ch <span style="color: #eedd82;">=</span> <span style="color: #00ffff;">case</span> ch <span style="color: #00ffff;">of</span>
  <span style="color: #00ff00;">'n'</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">North</span>
  <span style="color: #00ff00;">'s'</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">South</span>
  <span style="color: #00ff00;">'e'</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">East</span>
  <span style="color: #00ff00;">'w'</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">West</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> setting up pieces</h2>
<div class="outline-text-2" id="text-6">
<p>
So, now I want to actually apply the moves to the board.
</p>

<p>
I couldn't figure out how to convince the type system to let me make Board an instance of Functor, but that's probably okay, because as I visit the squares I actually need to know both the coordinates and the contents. So:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">apply</span> <span style="color: #eedd82;">::</span> (<span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Square</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Content</span>) <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span>
<span style="color: #ffffff; font-weight: bold;">apply</span> f br <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">$</span> array fullBounds <span style="color: #eedd82;">$</span> contents
             <span style="color: #00ffff;">where</span> contents <span style="color: #eedd82;">=</span> [(sq, f br sq) <span style="color: #eedd82;">|</span> sq <span style="color: #eedd82;">&lt;-</span> range fullBounds]
</pre>
</div>


<p>
Let's see how to define the popular 99of9 opening for gold. (see <a href="http://arimaa.com/arimaa/mwiki/index.php/Setup_Positions">http://arimaa.com/arimaa/mwiki/index.php/Setup_Positions</a> )
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">steps</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">String</span> <span style="color: #eedd82;">-&gt;</span> [<span style="color: #ff00ff;">Step</span>]
<span style="color: #ffffff; font-weight: bold;">steps</span> s <span style="color: #eedd82;">=</span> map parseStep <span style="color: #eedd82;">$</span> <span style="color: #ff00ff;">DSU</span><span style="color: #eedd82;">.</span>split <span style="color: #00ff00;">" "</span> s

<span style="color: #ffffff; font-weight: bold;">open99of9</span> <span style="color: #eedd82;">=</span> steps <span style="color: #00ff00;">"Ra1 Rb1 Rc1 Cd1 Ce1 Rf1 Rg1 Rh1 Ra2 Hb2 Dc2 Md2 Ee2 Df2 Hg2 Rh2"</span>
</pre>
</div>

<p>
So now:
</p>

<div class="org-src-container">

<pre class="src src-haskell">(<span style="color: #ffffff; font-weight: bold;">//=</span>) <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> [(<span style="color: #ff00ff;">Square</span>, <span style="color: #ff00ff;">Content</span>)] <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span>
(<span style="color: #ff00ff;">Board</span> br) <span style="color: #eedd82;">//=</span> changes <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">$</span> br <span style="color: #eedd82;">//</span> changes

<span style="color: #ffffff; font-weight: bold;">step</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Step</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span>
<span style="color: #ffffff; font-weight: bold;">step</span> st br <span style="color: #eedd82;">=</span> <span style="color: #00ffff;">case</span> st <span style="color: #00ffff;">of</span>
    <span style="color: #ff00ff;">Put</span>  p sq     <span style="color: #eedd82;">-&gt;</span> br <span style="color: #eedd82;">//=</span> [(sq, <span style="color: #ff00ff;">A</span> p)]    
    <span style="color: #ff00ff;">Kill</span> p sq     <span style="color: #eedd82;">-&gt;</span> todo
    <span style="color: #ff00ff;">Move</span> p sq d   <span style="color: #eedd82;">-&gt;</span> todo
    <span style="color: #ff00ff;">Resign</span>        <span style="color: #eedd82;">-&gt;</span> todo
    <span style="color: #ff00ff;">Takeback</span>      <span style="color: #eedd82;">-&gt;</span> todo
  <span style="color: #00ffff;">where</span>
    todo <span style="color: #eedd82;">=</span> br

<span style="color: #ffffff; font-weight: bold;">doSteps</span> <span style="color: #eedd82;">::</span> [<span style="color: #ff00ff;">Step</span>] <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span>
<span style="color: #ffffff; font-weight: bold;">doSteps</span> <span style="color: #ff00ff;">[]</span>      br <span style="color: #eedd82;">=</span> br
<span style="color: #ffffff; font-weight: bold;">doSteps</span> (s <span style="color: #ff00ff;">:</span>ss) br <span style="color: #eedd82;">=</span> doSteps ss <span style="color: #eedd82;">$</span> step s br
</pre>
</div>

<p>
How about the same for silver?
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">mirror</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Step</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Step</span>
<span style="color: #ffffff; font-weight: bold;">mirror</span> (<span style="color: #ff00ff;">Put</span> (<span style="color: #ff00ff;">Gold</span>, p) (x, y)) <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Put</span> (<span style="color: #ff00ff;">Silver</span>, p) (x, 9<span style="color: #eedd82;">-</span>y)
<span style="color: #ffffff; font-weight: bold;">mirror</span> other <span style="color: #eedd82;">=</span> other

<span style="color: #ffffff; font-weight: bold;">board99of9</span> <span style="color: #eedd82;">=</span> doSteps (gold <span style="color: #eedd82;">++</span> silver) emptyBoard
     <span style="color: #00ffff;">where</span> gold   <span style="color: #eedd82;">=</span> open99of9
           silver <span style="color: #eedd82;">=</span> map mirror gold
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> board queries</h2>
<div class="outline-text-2" id="text-7">
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #00ffff;">type</span> <span style="color: #ff00ff;">PieceAt</span> <span style="color: #eedd82;">=</span> (<span style="color: #ff00ff;">Piece</span>, <span style="color: #ff00ff;">Square</span>)
</pre>
</div>

<p>
contents br = [(sq, content br sq) | sq &lt;- range coreBounds]
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">content</span> sq (<span style="color: #ff00ff;">Board</span> br) <span style="color: #eedd82;">=</span> br <span style="color: #eedd82;">!</span> sq
</pre>
</div>


<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">neighbors</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Square</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> [(<span style="color: #ff00ff;">Direction</span>, <span style="color: #ff00ff;">PieceAt</span>)]
<span style="color: #ffffff; font-weight: bold;">neighbors</span> square br <span style="color: #eedd82;">=</span> [(dir, (pieceAt sq br, sq))
                         <span style="color: #eedd82;">|</span> (dir, sq)  <span style="color: #eedd82;">&lt;-</span> neighborSquares square
                         , isPiece <span style="color: #eedd82;">$</span> content sq br]
</pre>
</div>


<p>
Enemitos = lesser enemies (spanglish ftw!)
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">enemitos</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">PieceAt</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> [(<span style="color: #ff00ff;">Direction</span>, <span style="color: #ff00ff;">PieceAt</span>)]
<span style="color: #ffffff; font-weight: bold;">enemitos</span> ((c, a), sq) br <span style="color: #eedd82;">=</span> [n <span style="color: #eedd82;">|</span> n<span style="color: #eedd82;">@</span>(dir, ((c2, a2), <span style="color: #00ffff;">_</span>)) <span style="color: #eedd82;">&lt;-</span> neighbors sq br 
                              , a2 <span style="color: #eedd82;">&lt;</span> a  <span style="color: #eedd82;">&amp;&amp;</span> c2 <span style="color: #eedd82;">==</span> opp c]

<span style="color: #ffffff; font-weight: bold;">isPiece</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Content</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Bool</span>
<span style="color: #ffffff; font-weight: bold;">isPiece</span> (<span style="color: #ff00ff;">A</span> <span style="color: #00ffff;">_</span>) <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">True</span>
<span style="color: #ffffff; font-weight: bold;">isPiece</span> <span style="color: #00ffff;">_</span>     <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">False</span>

<span style="color: #ffffff; font-weight: bold;">toPiece</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Content</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Piece</span>
<span style="color: #ffffff; font-weight: bold;">toPiece</span> (<span style="color: #ff00ff;">A</span> p) <span style="color: #eedd82;">=</span> p
<span style="color: #ffffff; font-weight: bold;">toPiece</span> <span style="color: #00ffff;">_</span>     <span style="color: #eedd82;">=</span> error <span style="color: #00ff00;">"not a piece!"</span>

<span style="color: #ffffff; font-weight: bold;">pieceAt</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Square</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Piece</span>
<span style="color: #ffffff; font-weight: bold;">pieceAt</span> sq br  <span style="color: #eedd82;">=</span> toPiece <span style="color: #eedd82;">$</span> content sq br

<span style="color: #ffffff; font-weight: bold;">pieceSquares</span> br <span style="color: #eedd82;">=</span> [sq <span style="color: #eedd82;">|</span> sq <span style="color: #eedd82;">&lt;-</span> range coreBounds,  isPiece <span style="color: #eedd82;">$</span> content sq br]

<span style="color: #ffffff; font-weight: bold;">isEmpty</span> sq br <span style="color: #eedd82;">=</span> <span style="color: #00ffff;">case</span> content sq br <span style="color: #00ffff;">of</span>
                   <span style="color: #ff00ff;">Empty</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">True</span>
                   <span style="color: #ff00ff;">Trap</span>  <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">True</span>
                   <span style="color: #00ffff;">_</span>     <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">False</span>

<span style="color: #ffffff; font-weight: bold;">army</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Color</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> [<span style="color: #ff00ff;">PieceAt</span>]
<span style="color: #ffffff; font-weight: bold;">army</span> c br <span style="color: #eedd82;">=</span>  [(pieceAt sq br, sq) <span style="color: #eedd82;">|</span> sq <span style="color: #eedd82;">&lt;-</span> pieceSquares br
                                  , colorOf (pieceAt sq br) <span style="color: #eedd82;">==</span> c]

<span style="color: #ffffff; font-weight: bold;">colorOf</span> <span style="color: #eedd82;">::</span> (<span style="color: #ff00ff;">Color</span>, a) <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Color</span>
<span style="color: #ffffff; font-weight: bold;">colorOf</span> <span style="color: #eedd82;">=</span> fst


<span style="color: #ffffff; font-weight: bold;">isColor</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Color</span> <span style="color: #eedd82;">-&gt;</span> (<span style="color: #ff00ff;">Color</span>, a) <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Bool</span>
<span style="color: #ffffff; font-weight: bold;">isColor</span> c <span style="color: #eedd82;">=</span> <span style="color: #eedd82;">\</span>x <span style="color: #eedd82;">-&gt;</span> colorOf x <span style="color: #eedd82;">==</span> c
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> Movement rules.</h2>
<div class="outline-text-2" id="text-8">
</div><div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> summary</h3>
<div class="outline-text-3" id="text-8-1">
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">validSteps</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Color</span> <span style="color: #eedd82;">-&gt;</span> [<span style="color: #ff00ff;">Step</span>] <span style="color: #eedd82;">-&gt;</span> [<span style="color: #ff00ff;">Step</span>]
<span style="color: #ffffff; font-weight: bold;">validSteps</span> b c ss <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">[]</span> <span style="color: #66f;">-- </span><span style="color: #66f;">TODO</span>
</pre>
</div>

<p>
validPushes <del>+ validPulls +</del> validSteps
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">emcTestBoard</span> <span style="color: #eedd82;">=</span> doSteps (steps <span style="color: #00ff00;">"Ed3 me3 Ce4"</span>) emptyBoard
<span style="color: #ffffff; font-weight: bold;">emcE</span> <span style="color: #eedd82;">=</span> head <span style="color: #eedd82;">$</span> army <span style="color: #ff00ff;">Gold</span> emcTestBoard
<span style="color: #ffffff; font-weight: bold;">emcM</span> <span style="color: #eedd82;">=</span> head <span style="color: #eedd82;">$</span> army <span style="color: #ff00ff;">Silver</span> emcTestBoard 
<span style="color: #ffffff; font-weight: bold;">emcC</span> <span style="color: #eedd82;">=</span> head <span style="color: #eedd82;">$</span> tail <span style="color: #eedd82;">$</span> army <span style="color: #ff00ff;">Gold</span> emcTestBoard
</pre>
</div>

<p>
Which looks like this:
</p>

<pre class="example">
 +-----------------+
8|                 |
7|                 |
6|     x     x     |
5|                 |
4|         C       |
3|     x E m x     |
2|                 |
1|                 |
 +-----------------+
   a b c d e f g h
</pre>
</div>
</div>
<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> 1. Pieces move in cardinal directions, except that rabbits cannot move backward.</h3>
<div class="outline-text-3" id="text-8-2">
</div><div id="outline-container-sec-8-2-1" class="outline-4">
<h4 id="sec-8-2-1"><span class="section-number-4">8.2.1</span> forward and backward:</h4>
<div class="outline-text-4" id="text-8-2-1">
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">fore</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Color</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Direction</span>
<span style="color: #ffffff; font-weight: bold;">fore</span> <span style="color: #ff00ff;">Gold</span>   <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">North</span>
<span style="color: #ffffff; font-weight: bold;">fore</span> <span style="color: #ff00ff;">Silver</span> <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">South</span>

<span style="color: #ffffff; font-weight: bold;">back</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Color</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Direction</span>
<span style="color: #ffffff; font-weight: bold;">back</span> <span style="color: #eedd82;">=</span> fore <span style="color: #eedd82;">.</span> opp

<span style="color: #ffffff; font-weight: bold;">opp</span> <span style="color: #ff00ff;">Gold</span> <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Silver</span>
<span style="color: #ffffff; font-weight: bold;">opp</span> <span style="color: #ff00ff;">Silver</span> <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Gold</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-8-2-2" class="outline-4">
<h4 id="sec-8-2-2"><span class="section-number-4">8.2.2</span> valid empty squares</h4>
<div class="outline-text-4" id="text-8-2-2">
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">emptyDirs</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">PieceAt</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> [<span style="color: #ff00ff;">Direction</span>]
<span style="color: #ffffff; font-weight: bold;">emptyDirs</span> (p, sq) br <span style="color: #eedd82;">=</span> [dir <span style="color: #eedd82;">|</span> dir <span style="color: #eedd82;">&lt;-</span> potentialDirs p, isEmpty (dir <span style="color: #eedd82;">@:</span> sq) br]
</pre>
</div>

<p>
test: [North, East, West] <code>= emptyDirs (('b', 5), (g R)) emptyBoard
test: [South, East, West] =</code> emptyDirs (('b', 5), (s R)) emptyBoard
test: [South, East]       == emptyDirs (('a', 5), (s R)) emptyBoard
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">potentialDirs</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Piece</span> <span style="color: #eedd82;">-&gt;</span> [<span style="color: #ff00ff;">Direction</span>]
<span style="color: #ffffff; font-weight: bold;">potentialDirs</span> (color, pc) <span style="color: #eedd82;">=</span>
   <span style="color: #00ffff;">case</span> pc <span style="color: #00ffff;">of</span> 
      <span style="color: #ff00ff;">R</span>  <span style="color: #eedd82;">-&gt;</span> (foreAndSides color) 
      <span style="color: #00ffff;">_</span>  <span style="color: #eedd82;">-&gt;</span> (back color) <span style="color: #ff00ff;">:</span> (foreAndSides color)
   <span style="color: #00ffff;">where</span> foreAndSides color <span style="color: #eedd82;">=</span> fore color <span style="color: #ff00ff;">:</span> [<span style="color: #ff00ff;">East</span>, <span style="color: #ff00ff;">West</span>]
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-8-2-3" class="outline-4">
<h4 id="sec-8-2-3"><span class="section-number-4">8.2.3</span> valid single-step moves:</h4>
<div class="outline-text-4" id="text-8-2-3">
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">validMoves</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">PieceAt</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> [[<span style="color: #ff00ff;">Step</span>]]
<span style="color: #ffffff; font-weight: bold;">validMoves</span> pcAt<span style="color: #eedd82;">@</span>(p, sq) br <span style="color: #eedd82;">=</span> [[<span style="color: #ff00ff;">Move</span> p sq d] <span style="color: #eedd82;">|</span> d <span style="color: #eedd82;">&lt;-</span> emptyDirs pcAt br ]
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-8-3" class="outline-3">
<h3 id="sec-8-3"><span class="section-number-3">8.3</span> 2. Pieces can push or pull weaker enemy pieces provided there are &gt;= 2 steps left.</h3>
<div class="outline-text-3" id="text-8-3">
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #66f;">-- </span><span style="color: #66f;">&gt;&gt;&gt; validPushes emcE emcTestBoard</span>
<span style="color: #66f;">-- </span><span style="color: #66f;">[[me3s,Ed3e],[me3e,Ed3e]]</span>
<span style="color: #66f;">-- </span><span style="color: #66f;">&gt;&gt;&gt; validPulls emcE emcTestBoard</span>
<span style="color: #66f;">-- </span><span style="color: #66f;">[[Ed3s,me3w],[Ed3n,me3w],[Ed3w,me3w]]</span>
</pre>
</div>

<p>
To push, move the enemy piece, then move your piece where the enemy started.
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">push</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">PieceAt</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Direction</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Direction</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> [<span style="color: #ff00ff;">Step</span>]
<span style="color: #ffffff; font-weight: bold;">push</span> (pc, sq) pcDir enDir br <span style="color: #eedd82;">=</span> [<span style="color: #ff00ff;">Move</span> en enSq enDir, <span style="color: #ff00ff;">Move</span> pc sq pcDir]
   <span style="color: #00ffff;">where</span> en <span style="color: #eedd82;">=</span> pieceAt enSq br
         enSq <span style="color: #eedd82;">=</span> pcDir <span style="color: #eedd82;">@:</span> sq
</pre>
</div>

<p>
piece p1 can push adjacent enemy p2 if p1 &gt; p2 and p2 has adjacent empty square
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">validPushes</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">PieceAt</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> [[<span style="color: #ff00ff;">Step</span>]]
<span style="color: #ffffff; font-weight: bold;">validPushes</span> pcAt<span style="color: #eedd82;">@</span>((c, a), sq) br <span style="color: #eedd82;">=</span> 
   [push pcAt pcDir enDir br
       <span style="color: #eedd82;">|</span> (pcDir, en) <span style="color: #eedd82;">&lt;-</span> enemitos pcAt br
       , enDir <span style="color: #eedd82;">&lt;-</span> emptyDirs en br ]
</pre>
</div>


<p>
To pull, move your piece, then move the enemy to where your piece started.
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">pull</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">PieceAt</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Direction</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Direction</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> [<span style="color: #ff00ff;">Step</span>]
<span style="color: #ffffff; font-weight: bold;">pull</span> (pc, sq) pcDir enDir br <span style="color: #eedd82;">=</span> [<span style="color: #ff00ff;">Move</span> pc sq pcDir, <span style="color: #ff00ff;">Move</span> en enSq enDelta]
   <span style="color: #00ffff;">where</span> en <span style="color: #eedd82;">=</span> pieceAt enSq br
         enSq <span style="color: #eedd82;">=</span> enDir <span style="color: #eedd82;">@:</span> sq
         enDelta <span style="color: #eedd82;">=</span> rev enDir
</pre>
</div>

<p>
piece p1 can pull adjacent enemy p2 if p1 &gt; p2 and p1 has adjacent empty square
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">validPulls</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">PieceAt</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> [[<span style="color: #ff00ff;">Step</span>]]
<span style="color: #ffffff; font-weight: bold;">validPulls</span> pcAt<span style="color: #eedd82;">@</span>((c, a), sq) br <span style="color: #eedd82;">=</span> 
   [pull pcAt pcDir enDir br
       <span style="color: #eedd82;">|</span> (enDir, en) <span style="color: #eedd82;">&lt;-</span> enemitos pcAt br
       , pcDir <span style="color: #eedd82;">&lt;-</span> emptyDirs pcAt br ]
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-8-4" class="outline-3">
<h3 id="sec-8-4"><span class="section-number-3">8.4</span> 3. A piece is frozen when adjacent to a stronger enemy, unless it is also adjacent to another friendly piece.</h3>
<div class="outline-text-3" id="text-8-4">
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #228b22;">-- | is the piece frozen?</span>
<span style="color: #228b22;">-- &gt;&gt;&gt; frozen emcE emcTestBoard</span>
<span style="color: #228b22;">-- False</span>
<span style="color: #228b22;">-- &gt;&gt;&gt; frozen emcM emcTestBoard</span>
<span style="color: #228b22;">-- True</span>
<span style="color: #228b22;">-- &gt;&gt;&gt;  frozen emcC emcTestBoard</span>
<span style="color: #228b22;">-- False</span>
<span style="color: #ffffff; font-weight: bold;">frozen</span> pcAt br <span style="color: #eedd82;">|</span> hasFriend pcAt br <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">False</span>
               <span style="color: #eedd82;">|</span> otherwise <span style="color: #eedd82;">=</span> hasThreat pcAt br
</pre>
</div>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">hasFriend</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">PieceAt</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Bool</span>
<span style="color: #ffffff; font-weight: bold;">hasFriend</span> ((c, <span style="color: #00ffff;">_</span>), sq) br <span style="color: #eedd82;">=</span> any (<span style="color: #eedd82;">\</span>(p, s) <span style="color: #eedd82;">-&gt;</span> isColor c p) <span style="color: #eedd82;">$</span> map snd <span style="color: #eedd82;">$</span> neighbors sq br

<span style="color: #ffffff; font-weight: bold;">hasThreat</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">PieceAt</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Bool</span>
<span style="color: #ffffff; font-weight: bold;">hasThreat</span> ((c, a), sq) br <span style="color: #eedd82;">=</span> any biggerEnemy <span style="color: #eedd82;">$</span> map snd <span style="color: #eedd82;">$</span> neighbors sq br
   <span style="color: #00ffff;">where</span> biggerEnemy ((c2,  a2), <span style="color: #00ffff;">_</span>) <span style="color: #eedd82;">=</span> (a2 <span style="color: #eedd82;">&gt;</span> a) <span style="color: #eedd82;">&amp;&amp;</span> (not <span style="color: #eedd82;">$</span> c2 <span style="color: #eedd82;">==</span> c)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-8-5" class="outline-3">
<h3 id="sec-8-5"><span class="section-number-3">8.5</span> 4. A piece is killed when placed on a trap, unless it is also adjacent to a friendly piece.</h3>
<div class="outline-text-3" id="text-8-5">
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ffffff; font-weight: bold;">trapped</span> <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">PieceAt</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Board</span> <span style="color: #eedd82;">-&gt;</span> <span style="color: #ff00ff;">Bool</span>
<span style="color: #ffffff; font-weight: bold;">trapped</span> (p, sq) br <span style="color: #eedd82;">=</span> isTrap sq <span style="color: #eedd82;">&amp;&amp;</span> (not <span style="color: #eedd82;">$</span> hasFriend (p, sq) br)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> the Play State Monad</h2>
<div class="outline-text-2" id="text-9">
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #00ffff;">type</span> <span style="color: #ff00ff;">Move</span> <span style="color: #eedd82;">=</span> (<span style="color: #ff00ff;">Color</span>, [<span style="color: #ff00ff;">Step</span>])
<span style="color: #00ffff;">data</span> <span style="color: #ff00ff;">PlayState</span> <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">PlayState</span> {
  board     <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Board</span>,
  moveNum   <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Int</span>,
  toMove    <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Color</span>,
  stepsLeft <span style="color: #eedd82;">::</span> <span style="color: #ff00ff;">Int</span>,
  history   <span style="color: #eedd82;">::</span> [<span style="color: #ff00ff;">Move</span>],
  future    <span style="color: #eedd82;">::</span> [<span style="color: #ff00ff;">Move</span>]
} <span style="color: #00ffff;">deriving</span> <span style="color: #ff00ff;">Show</span>

<span style="color: #ffffff; font-weight: bold;">initState</span> <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">PlayState</span> {
  board     <span style="color: #eedd82;">=</span> emptyBoard,
  moveNum   <span style="color: #eedd82;">=</span> 1,
  toMove    <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">Gold</span>,
  stepsLeft <span style="color: #eedd82;">=</span> 4,
  history   <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">[]</span>,
  future    <span style="color: #eedd82;">=</span> <span style="color: #ff00ff;">[]</span>
}
</pre>
</div>
</div>
</div>
</div>
</body>
</html>
